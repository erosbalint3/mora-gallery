<!doctype html>
<html>
	<head>
		<meta charset="utf-8">

		<title>Móra Fényképek</title>

		<link rel="shortcut icon" href="favicon.webp">
		<link rel="stylesheet" href="photoswipe/photoswipe.css">

		<link href='https://fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
		<script type="module">
		import PhotoSwipeLightbox from '/photoswipe/photoswipe-lightbox.esm.js';
		import PhotoSwipe from '/photoswipe/photoswipe.esm.js';

		async function loadAlbum(year, album, longdesc){
			const LoadingTimeout = setTimeout(() => {
  				document.getElementById('gallery').innerHTML='Fényképek betöltése&#8230;';
			}, 2000);
			
			var image_list_url = 'https://gallery.mora.u-szeged.hu/filelist/' + year + '/' + album ;

			//TODO cache option for fetch and others
			const image_list_resp = await fetch(image_list_url);
			const image_list = await image_list_resp.json();

			let new_pictures = []; 

			if(!!longdesc && longdesc!='null'){
				const ld = document.createElement("span");
				ld.innerHTML=longdesc;
				new_pictures.push(ld);
			}

			image_list.forEach(image => {
			const newa = document.createElement("a");
			newa.setAttribute("href", "https://gallery.mora.u-szeged.hu/watermark/jpeg/" + image.filename);
			newa.setAttribute("data-pswp-width", image.width);
			newa.setAttribute("data-pswp-height", image.height);
			//newa.setAttribute("data-pswp-webp-src", "https://gallery.mora.u-szeged.hu/cgi-bin/watermark/webp/" + image.filename);
			newa.setAttribute("target", "_blank");

			const thumbnail = document.createElement("img");
			thumbnail.setAttribute("src", "https://gallery.mora.u-szeged.hu/thumbnail/jpeg/" + image.filename);
			thumbnail.setAttribute("loading","lazy");
			thumbnail.style.aspectRatio=''+image.width+'/'+image.height;

			newa.appendChild(thumbnail);

			const newfigure = document.createElement("figure");
			newfigure.appendChild(newa);

			new_pictures.push(newfigure);
			});

			clearTimeout(LoadingTimeout);
			document.getElementById('gallery').replaceChildren(...new_pictures);

			const lightbox = new PhotoSwipeLightbox({
			gallery: '#gallery',
			children: 'a',
			pswpModule: PhotoSwipe
			});
			//TODO webp support!!!!

			lightbox.init();
			document.getElementById("gallery").scrollIntoView({behavior: "smooth"});
		}

	window.loadAlbum = loadAlbum;
		</script>
		<script>
			function listyear(year){ var albumlist_url = "https://gallery.mora.u-szeged.hu/albumlist/" + year;
				fetch(albumlist_url).then(
					resp => {
						resp.json().then(
							albums=> {
								console.log(albums);
								let albumelements = [];
								albums.forEach( album => {
									var newalbum = document.createElement("figure"); 
									newalbum.addEventListener("click", function(){loadAlbum(album.year, album.name, album.longdesc);});
									var newimg = document.createElement("img");
									if (!album.thumbnail || album.thumbnail=='null') {
										newimg.setAttribute("src","logo.png");
									} else {
										newimg.setAttribute("src","https://gallery.mora.u-szeged.hu/thumbnail/jpeg/" + album.year + '/' + album.name + '/' + album.thumbnail);
									}
									newimg.setAttribute("loading","lazy");
									if(!!album.longdesc && album.longdesc!='null'){
										newimg.setAttribute("alt", album.longdesc);
									}
									newalbum.appendChild(newimg);
									var newcaption = document.createElement("figcaption");
									newcaption.innerHTML=album.desc;
									newalbum.appendChild(newcaption);
									albumelements.push(newalbum);
								});
								document.getElementById("albums").replaceChildren(...albumelements);
							}
						);
					});
			}
		</script>

		<style>
			body 
			{
				font-family: 'Bitter', Georgia, Times, sans-serif;
				
				background-color: #fff4cc;
			}
			
			.pswp__caption__center
			{
				text-align: center;
			}
			#img
			{
				width: 100%;
			}
			#gallery{
				display: flex;
				justify-content: center;
				flex-wrap: wrap;
				align-items: center;
				align-content: space-evenly;
				gap: 10px;
			}
			#albums
			{
				display: flex;
				flex-wrap: wrap;
				gap: 5px;
			}
			#albums > figure
			{
				max-width: 200px;
				border: thin grey solid;
				display: flex;
				flex-flow: column-reverse;
				padding: 5px;
				cursor: pointer;
				justify-content: flex-start;
			}
			#albums > figure > img
			{
				max-width: inherit;
				max-height: inherit;
			}
			#albums > figure > figcaption
			{
				text-align: center;
				padding : 3px;
				color: white;
				background-color: #a3850f;
			}
			#years > button:hover
			{
				background-color: #a3850f; /* Green */
				color: white;
			}

			#years > button
			{
				background-color: #edd679;
				border: 2px solid; 
				border-color: #a89239;
				color: #fcf6dc;
				padding: 16px 32px;
				text-align: center;
				text-decoration: none;
				display: inline-block;
				font-size: 16px;
				margin: 4px 2px;
				transition-duration: 0.4s;
				cursor: pointer;
				font-weight: bold;
				font-size: large;
			}
			figure
			{
				margin: 0px;
			}
			#gallery > figure > a > img {
				height: 250px;
				max-height: 33vh;
				max-width: 50vh !important;
				width: auto;
			}
			#gallery > span {
				max-width: 80vh !important;
				width: auto;
				border: 3px solid burlywood;
				padding: 10px;
				font-style: oblique;
				text-align: center;
				touch-action: pan-down;
				line-height: 1.6;
				font-size: larger;
			}
			body{
				font-family: 'Trocchi', serif;
			}
			header{
				font-size: 45px;
			}
			header > img {
				height: 100px;
			}
			#scroll-up {
				background-color: burlywood;
				color: white;
				text-decoration: none;
				padding: 10px;
				font-style: oblique;
				text-align: center;
				font-size: large;
				position: fixed;
				bottom: 20px;
				right: 20px;
			}
		</style>
	</head>
	<body>
		<header>
			<img src="logo.png"/> SZTE Móra Ferenc Szakkollégium &#8211; Képarchívum BÉTA
		</header>
		<hr />
		<div id="years">
			<script>
				var yearlist_url = "https://gallery.mora.u-szeged.hu/yearlist";
				fetch(yearlist_url).then(
					resp => {
						resp.json().then(years => {
							years.sort(); years.reverse();
								console.log(years);
								let yearelements=[];
								years.forEach(year => {
									var newyear = 		document.createElement("button");
									newyear.setAttribute("type", "button");
									newyear.innerHTML = year;
									newyear.onclick=function(){ listyear(year); };
									yearelements.push(newyear);
								});
								document.getElementById("years").replaceChildren(...yearelements);
								listyear(Math.max(...years));
							});
					});
			</script>
		</div>
		<hr />
		<div id="albums">
		</div>
		<hr />
		<div id="gallery">
			<span>Válasszon a fenti albumok közül!</span>
		</div>
		<hr />
		<footer>
			Copyright SZTE Móra Ferenc Szakokllégium 2022 <a href="impresszum.html">Impresszum</a>
		</footer>


		<a id="scroll-up" href="#albums">
			&uArr;
		</a>
	</body>
</html>
